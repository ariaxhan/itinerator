---
import { addDoc, collection } from "firebase/firestore";
import { db } from "../firebase";
---

<script>
  import { onMount } from "astro";

  onMount(() => {
    const buttons = document.querySelectorAll('.options .button');
    const submitButton = document.querySelector('.submit-button');

    if (buttons.length > 0) {
      buttons.forEach(button => {
        button.addEventListener('click', (e) => {
          const target = e.target;
          const buttonsInGroup = target.closest('.options')?.querySelectorAll('.button');

          if (buttonsInGroup) {
            buttonsInGroup.forEach(btn => btn.classList.remove('selected'));
          }
          target.classList.add('selected');

          console.log(`Button clicked: ${target.textContent}`); // Debugging statement
        });
      });
    }

    async function submitQuiz() {
      if (!db) {
        console.error("Firestore database is not initialized.");
        return;
      }

      const selectedOptions = document.querySelectorAll('.options .button.selected');
      const data = {};

      selectedOptions.forEach(option => {
        const questionElement = option.closest('.options')?.previousElementSibling;
        const question = questionElement ? questionElement.textContent : '';
        const answer = option.textContent || '';
        data[question || ''] = answer;
      });

      try {
        const docRef = await addDoc(collection(db, "quizResults"), data);
        console.log("Document written with ID: ", docRef.id);
      } catch (e) {
        console.error("Error adding document: ", e);
      }
    }

    if (submitButton) {
      submitButton.addEventListener('click', submitQuiz);
    }
  });
</script>